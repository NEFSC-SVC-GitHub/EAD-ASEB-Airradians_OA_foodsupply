---
title: "Respiration Analysis F1 Scallops 2021"
author: "Samuel Gurr"
date: "10/6/2021"
output:
  pdf_document:
    latex_engine: xelatex
---


```{r setup, include=FALSE}

# LOAD PACKAGES :::::::::::::::::::::::::::::::::::::::::::::::::::::::

library(dplyr)
library(ggplot2)
library(forcats)
library(lme4)
library(lmerTest)
library(see)
library(performance)
library(car)
library(kableExtra)
library(pander)
library(data.table)
library(stringr)
library(latex2exp)
library(Rmisc)
library(devtools)
# SET WORKING DIRECTORY :::::::::::::::::::::::::::::::::::::::::::::::

# setwd("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis") # personal computer
 setwd("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis") # Work computer
# setwd("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis") # Work computer

# LOAD DATA :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

resp.data       <- read.csv(file="Output/Respiration/Cumulative_resp_alpha0.4_15sectrunc1hour.csv", header=T) %>% 
                      dplyr::filter(!Date %in% "9/14/2021" | !Filename %in% 'Run_1_raw.txt') # read the calculate raw rates from 'resp_LoLin' script - contains the calculated rate (not normalized for blanks) for each sensor-channel
exp_metadata    <- read.csv(file="Data/ExperimentMetadata.csv", header=T) # treatment assignments to 'Chamber_Tank'
lengths         <- read.csv(file="Data/Respiration/Lengths_Condition_resp_clearance.csv", header=T)
resp.ref        <- read.csv(file="Data/Respiration/Reference_master.csv", header=T) %>% dplyr::filter(!Date %in% "9/14/2021" | !Filename %in% 'Run_1_raw.txt')
DWs_Len_1026    <- read.csv(file="Data/Survival_Size/20211026_lengths_dryweights.csv", header=T)
DWs_Len_914.930 <- read.csv(file="Data/Survival_Size/2021914_930_dryweights.csv", header=T)

```

# Standardize rates by dry tissue weight 

* NOTE: we have tissue dry weights for the large animals on 1026 (was able to dissect them) whereas we have whole animal dry weights for 914 and 930 
* here we run regressions on the 1026 dats (shell length v. tissue dry weight) to extrapolate tissue weight for smaller shell sizes (914 and 930) 


```{r dry weight and length data, echo=FALSE}

# Tissue Dry Weight (DW) vs Shell length :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

# filter data
Tissue_DW_1026 <- DWs_Len_1026 %>% dplyr::filter(shell.or.tissue %in% "tissue")

# note: the raw shell length data yields a curved equation - shell length^2 yields a near-linear fit 

Tissue_DW_1026_subset <- Tissue_DW_1026 %>% dplyr::filter(Shell.Length < 10)  # animals < 10 um shelllength
fit                   <- lm(weight ~ (Shell.Length)^2, data = Tissue_DW_1026_subset)
P_DW_v_ShellLen2      <- ggplot(data = Tissue_DW_1026_subset, aes(x = (Shell.Length)^2, y = weight)) +
                                geom_smooth(method = "lm", se=FALSE, color="black", formula = weight ~ Shell.Length) +
                                theme_classic() +
                                ylab("Tissue dry weight (mg)") +
                                xlab("[ Shell length (um) ]^2") +
                                # stat_function(fun=my_eq, colour="red") +
                                geom_point() + 
                                xlim(0,100) +
                                annotate(label = sprintf("y = %.3f x\nR² = %.2f", coef(fit), summary(fit)$r.squared),
                                         geom = "text", x = 80, y = 0.0010, size = 5) +
                                geom_smooth(method='lm') # y~0+x if you want it through the origin (0,0)



# 20210914 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


Length_914           <- lengths         %>% 
  dplyr::filter(Date %in% '9/14/2021')  %>% 
  dplyr::select(c("Replicate","pH","Number","Food", "Run", "Food", "Plate", "Length_um"))
Dryweight_914        <- DWs_Len_914.930 %>% 
  dplyr::filter(Date %in% '20210914')   %>% 
  dplyr::filter(Purpose %in% 'resp_filtration') %>% 
  dplyr::rename(Replicate = Rep)        %>% 
  dplyr::rename(pH = Treatment)         %>% 
  dplyr::rename(Number = Num)           %>% 
  dplyr::select(c("Replicate","pH","Number", "Plate","Run","Scallop_DW_mg"))
DW_Len_914 <- merge(Length_914, Dryweight_914)
DW_Len_914$Date <- "9/14/2021"


DW_Len_914 %>% ggplot(aes(x = Length_um, y = Scallop_DW_mg)) +
        geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
        theme_classic() +
        ylab("Whole animal dry weight (mg)") +
        xlab("Shell length (um)") +
        geom_point() + 
        geom_smooth(method='lm')




# 20210930 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::



Length_930           <- lengths         %>% 
  dplyr::filter(Date %in% '9/30/2021')  %>% 
  dplyr::select(c("Replicate","pH","Number", "Food", "Run", "Plate","Length_um"))
Dryweight_930        <- DWs_Len_914.930 %>% 
  dplyr::filter(Date %in% '20210930')   %>% 
  dplyr::filter(Purpose %in% 'resp_filtration') %>% 
  dplyr::rename(Number = Num)           %>% 
  dplyr::rename(Replicate = Rep)        %>% 
  dplyr::rename(pH = Treatment)         %>% 
  dplyr::rename(Food = Fed_unfed)       %>% 
  dplyr::select(c("Replicate","pH","Number", "Food", "Run", "Plate","Scallop_DW_mg"))
DW_Len_930 <- merge(Length_930, Dryweight_930)
DW_Len_930$Date <- "9/30/2021"

DW_Len_930 %>% ggplot(aes(x = Length_um, y = Scallop_DW_mg)) +
        geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
        theme_classic() +
        ylab("Whole animal dry weight (mg)") +
        xlab("Shell length (um)") +
        geom_point() + 
        geom_smooth(method='lm') + # y~0+x if you want it through the origin (0,0)
        facet_wrap(~Food)

# 20211026 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
Length_1026_Unfed    <- lengths         %>% 
  dplyr::filter(Date %in% '10/26/2021') %>% 
  dplyr::select(c("Replicate","pH","Number", "Food", "Run", "Plate","Length_um"))
Dryweight_1026_Unfed <- DWs_Len_914.930 %>% 
  dplyr::filter(Date %in% '20211026')   %>% 
  dplyr::filter(Purpose %in% 'resp_filtration') %>% 
  dplyr::rename(Food = Fed_unfed)       %>% 
  dplyr::rename(Replicate = Rep)        %>% 
  dplyr::rename(pH = Treatment)         %>% 
  dplyr::rename(Number = Num)           %>% 
  dplyr::select(c("Replicate","pH","Number", "Food","Run", "Plate",  "Scallop_DW_mg"))
DW_Len_1026_unfed <- merge(Length_1026_Unfed, Dryweight_1026_Unfed)
DW_Len_1026_unfed$Date <- "10/26/2021"

# fed data - 'lengths' has the dry weight for shell and tissue in the 'fed' animals o 10/26/2021

DW_Len_1026_Fed    <- lengths           %>% 
  dplyr::filter(Date %in% '10/26/2021' & Food %in% 'fed') %>% 
  dplyr::select(c("Replicate","pH","Number", "Food", "Run", "Plate","Length_um", 'Dry_Shell_weight', 'Dry_Tissue_weight')) %>% # call the dry weights that were complete separately 
  dplyr::mutate(Scallop_DW_mg = (Dry_Shell_weight + Dry_Tissue_weight)*1000) %>% # calculate the total animal dry weight and covert to mg ( *1000)- this corresponds with the data we have for smaller animals on previous dates
  dplyr::select(!c('Dry_Tissue_weight','Dry_Shell_weight')) # omit these to merge to the master file ""
DW_Len_1026_Fed$Date <- "10/26/2021"

rbind(DW_Len_1026_Fed, DW_Len_1026_unfed) %>% 
ggplot(aes(x = Length_um, y = Scallop_DW_mg)) +
        geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
        theme_classic() +
        ylab("Whole animal dry weight (mg)") +
        xlab("Shell length (um)") +
        geom_point() + 
        geom_smooth(method='lm') + # y~0+x if you want it through the origin (0,0)
        facet_wrap(~Food)







# Explore the DW and shell length relationship in our data...
Master_SizeStand_dat      <- rbind(DW_Len_1026_unfed, DW_Len_1026_Fed, DW_Len_930, DW_Len_914)
SizeStand_Plots           <- Master_SizeStand_dat[!is.na(Master_SizeStand_dat$Length_um),] %>%  
                            ggplot(aes(x = Length_um, y = Scallop_DW_mg)) +
                                geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
                                theme_classic() +
                                ylab("Whole animal dry weight (mg)") +
                                xlab("Shell length (um)") +
                                # stat_function(fun=my_eq, colour="red") +
                                geom_point() + 
                                # xlim(0,100) +
                                # annotate(label = sprintf("y = %.3f x\nR² = %.2f", coef(fit), summary(fit)$r.squared),
                                #          geom = "text", x = 80, y = 0.0010, size = 5) +
                                geom_smooth(method='loess')
SizeStand_Plots
```



## merge master resp data frame 

```{r merge resp with length data and treatment IDs, echo=FALSE}

# merge the exp_metadata with the resp.data
resp.ref_length_merged                 <- merge(resp.ref, lengths) # all TRUE allows us to keep the blanks
resp.data_merged                       <- merge(resp.data, resp.ref_length_merged) %>% # out master file moving forward....
                                            dplyr::mutate(filetype = str_sub(Filename, -3,-1)) %>% 
                                            dplyr::mutate(filetype = factor(ifelse(filetype == "csv", "SDR_data", "LoLigo_data")))
kable(head(resp.data_merged))

```

## Visual diagnostics of plots to correct poor data 

- View on github: Airradians_OA/RAnalysis/Output/Respiration/plots_alpha0.4_increm15sec/

#### found three calls that inaccurately represent the rates of oxygen consumption 

(1) https://github.com/SamGurr/Airradians_OA/blob/master/RAnalysis/Output/Respiration/plots_alpha0.4_increm15sec/20210930_Plate_2_Run_2_C5_regression.pdf
- solution = call 'Lz' instead of the default Leq

(2) https://github.com/SamGurr/Airradians_OA/blob/master/RAnalysis/Output/Respiration/plots_alpha0.4_increm15sec/20210930_Plate_2_Run_1_C1_regression.pdf
- solution = call 'Lz' instead of the default Leq

(3) https://github.com/SamGurr/Airradians_OA/blob/master/RAnalysis/Output/Respiration/plots_alpha0.4_increm15sec/20210930_Plate_1_Run_2_C1_regression.pdf
- solution = we reran this at the end of the LoLin script  for 0-20 minutes and got an Lpc  -0.0296, insert this 

```{r IMPORTANT correct poor data, echo=TRUE}
resp.data_merged[95,c(1:6)]  # 	C1 RR_9.30.21_AM_Plate_2_Run_1.csv # -0.02890813	-0.0608251	-0.0608251 - Lz and Leq call better regression than Lpc
resp.data_merged[111,c(1:6)] #  C5 RR_9.30.21_PM_Plate_2_Run_2.csv	0.029052351	-0.076034441	-0.076034441
resp.data_merged[96,c(1:6)]  # 	C1 RR_9.30.21_PM_Plate_1_Run_2.csv	0.011656487	0.011656487	0.011656487  - ommit this

resp.data_merged[95,4] <- resp.data_merged[95,5] # 20210930_Plate_2_Run_2_C5_regression - Lz and Leq call better regression than Lpc
resp.data_merged[111,4] <- resp.data_merged[111,5] # 20210930_Plate_2_Run_1_C1_regression - Lz and Leq call better regression than Lpc
resp.data_merged[96,4] <- -0.0296 # 20210930_Plate_1_Run_2_C1_regression - plot shows noise after the 20 minutes mark, we reran this at the end of the LoLin script, insert here!

resp.data_merged[95,c(1:6)]
resp.data_merged[111,c(1:6)]
resp.data_merged[96,c(1:6)]
```

# Calculate blanks, print all and means

```{r call blanks, echo=FALSE}

blanks_total <- data.frame() # start dataframe 
blanks.table <- data.frame(matrix(nrow = 1,ncol = 5)) # make a table template
colnames(blanks.table)<-c('Date', 'Channel', 'mean_Lpc', 'mean_Leq' , 'mean_Lz') # names for comuns in the for loop

blanks_all_raw <- data.frame(merge(resp.ref, resp.data, by = c('Date', 'Channel', 'Filename')) %>% 
                  dplyr::mutate(filetype = str_sub(Filename, -3,-1)) %>% 
                  dplyr::mutate(filetype = factor(ifelse(filetype == "csv", "SDR_data", "LoLigo_data"))) %>% 
                  dplyr::filter(Chamber_tank  == 'blank') %>% 
                  dplyr::filter(Lpc <0) %>% 
                  dplyr::filter(!Date == '9/30/2021' | !Lpc < -0.035) %>% #omits C6 RR_9.30.21_AM_Plate_1_Run_1.csv	8.0	blank - View the Lolin plot, looks noisy and a fast outlier from the others
                  dplyr::filter(!Date == '10/26/2021'  | !Channel == "CH8" | !Run == "2" )) # omit a bad blank that contained a bad seal, noted on the respiration sampling day during the trial 
kable((blanks_all_raw)[,c(1:3,6,8,12:14)])

blanks_means <- blanks_all_raw %>% 
     dplyr::group_by(Date, pH, filetype) %>% 
     dplyr::filter(Chamber_tank == "blank") %>% 
     dplyr::filter(Lpc <0) %>% # ommit blank calls that d/n represent oxygen consumption
     dplyr::summarise(BLANK.mean_Lpc = mean(abs(Lpc)),
                      BLANK.sd.Lpc   = sd(abs(Lpc)),
                      BLANK.mean_Leq = mean(abs(Leq)), 
                      BLANK.mean_Lz = mean(abs(Lz)),
                      n = n())
kable(blanks_means)


```

# Blank-standardized rates as 'resp_blankStand'

## Merge blanks with the master file by Date, pCO2 treatment, and filetype

* 'filteype' is only important here on 20211026 when both Loligo and SDR were used due to difference in size for fed (larger) and unfed animals 

```{r merge blanks_means for a master file, echo=FALSE}

Resp.Master <- merge(resp.data_merged, blanks_means, by=c("Date", "pH",  "filetype")) %>% # NOTE: this repeats for every distinct length value
  dplyr::mutate(resp_blankStand = Lpc - BLANK.mean_Lpc) # ommits respiration rate values showing an increase in O2 over time 

```


# Master Resp file, with volumes and file types, etc. as 'Calculated_Resp_Master.csv'

## dplyr::mutate for the following:

* 'volume' of the different vessels throughout the fed*OA challenge
* 'Age'
8 'Fed_unfed'
* 'pCO2'

```{r merge data to master file and write csv, echo=FALSE}

Resp.Master_OM <- Resp.Master[!is.na(Resp.Master$Length_um),] %>% dplyr::filter(!resp_blankStand > 0) %>% # ommit respiration values that are positive  
  dplyr::mutate(volume = case_when(filetype == "LoLigo_data" & Date == '9/14/2021' ~ 1.7, # small vessels for loligo system
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH1' ~ 68.55323, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH2' ~ 68.85583, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH3' ~ 68.87473, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH4' ~ 68.95481, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH5' ~ 68.57288, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH6' ~ 68.01878, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH7' ~ 68.54551, # larger custom vessels measured individually...
                                   filetype == "LoLigo_data" & Date == '10/26/2021' & Channel == 'CH8' ~ 68.53297, # larger custom vessels measured individually...
                                   filetype == "SDR_data" ~ 2.2)) %>% # 24-well plate 
  
  dplyr::mutate(Age = case_when(Date == '9/14/2021' ~ 50, Date == '9/30/2021' ~ 66, Date == '10/26/2021' ~ 92)) %>% 
  dplyr::mutate(Fed_Unfed = case_when(Fed_Unfed == 'F' ~ "High food", is.na(Fed_Unfed) ~ "High food", Fed_Unfed == 'U' ~ "Low food")) %>% 
  dplyr::mutate(pCO2 = case_when(pH == 8.0 ~ "500 μatm", pH == 7.5 ~ "800 μatm"))
Resp.outliers <- Resp.Master %>% dplyr::filter(resp_blankStand > 0) # call the values with positive resp rates, measing they were slower than the blank!
print(Resp.outliers)

#write.csv(Resp.Master_OM, "C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/Calculated_Resp_Master.csv")
write.csv(Resp.Master_OM, "C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/Calculated_Resp_Master.csv")

```



# b factor plots 

## Shell length

All physiological rates were standardized for a _____ um shell length per individual. This length, corresponding to the median shell length of all individuals monitored during this experiment, was chosen to keep standardized rates consistent with  one  length and  minimize error.


### EQ: Ys=(Ws/Wsc)^b(Ye)

* Ys   =  shell length-standardized physiological rate (respiration in this case..) 
* Ws   =  median shell length per individual in this experiment (fed v. unfed betwen 9/14 - 10/26)
* Wsc  =  shell length for each bay scllop 
* b    =  allometric coefficient estimated from the shell length and the physiolgoical process (in this case respiration rate) as Ye = (a)Wsc^b 
* Ye   =  the experimentally measured rate 

```{r b factor, echo=TRUE}

Resp.Master_OM$resp_volStand_mg_L_hr <- ( (abs(Resp.Master_OM$resp_blankStand)) * # call absolute value of resp in mg per minute - convert to ng min-1
                (Resp.Master_OM$volume/1000) ) * 60

Resp.Master_OM$Length_um <- (as.numeric(Resp.Master_OM$Length_um))
Resp.Master_OM$Length_mm <- (Resp.Master_OM$Length_um/1000)

AllLength_lm_eqn <- function(Resp.Master_OM){
                    #m <- lm(resp_volStand_mg_L_hr ~ Length_um, Resp.Master_OM);
                    m <- lm(resp_volStand_mg_L_hr ~ exp(Length_mm), Resp.Master_OM);
                    eq <- substitute(italic(y) == a %.% (x)^b*","~~italic(r)^2~"="~r2, 
                         list(a = format(unname(coef(m)[1]), digits = 2),
                              b = format(unname(coef(m)[2]), digits = 2),
                             r2 = format(summary(m)$r.squared, digits = 3)))
                    as.character(as.expression(eq));
}


Length_pH8  <- Resp.Master_OM %>% dplyr::filter(pH %in% 8)
Length_8_lm_eqn  <- function(Length_pH8){
                    #m <- lm(resp_volStand_mg_L_hr ~ Length_um, Length_pH8);
                    m <- lm(resp_volStand_mg_L_hr ~  exp(Length_um), Length_pH8);
                    eq <- substitute(italic(y) == a %.% (x)^b*","~~italic(r)^2~"="~r2, 
                         list(a = format(unname(coef(m)[1]), digits = 2),
                              b = format(unname(coef(m)[2]), digits = 2),
                             r2 = format(summary(m)$r.squared, digits = 3)))
                    as.character(as.expression(eq));
}
Length_pH7.5  <- Resp.Master_OM %>% dplyr::filter(pH %in% 7.5)
Length_7.5_lm_eqn <- function(Length_pH7.5){
                    #m <- lm(resp_volStand_mg_L_hr ~ Length_um, Length_pH7.5);
                    m <- lm(resp_volStand_mg_L_hr ~  exp(Length_um), Length_pH7.5);
                    eq <- substitute(italic(y) == a %.% (x)^b*","~~italic(r)^2~"="~r2, 
                         list(a = format(unname(coef(m)[1]), digits = 2),
                              b = format(unname(coef(m)[2]), digits = 2),
                             r2 = format(summary(m)$r.squared, digits = 3)))
                    as.character(as.expression(eq));
}

??method.args 



Resp.Master_OM %>% dplyr::filter(pH %in% 8) %>%
ggplot(aes(x =  Length_um, y = resp_volStand_mg_L_hr)) +
            geom_point() +
            geom_smooth(method="glm",
            method.args=list(family= quasibinomial(link = 'logit'))) #+





Resp.Master_OM %>% dplyr::filter(pH %in% 7.5) %>%
ggplot(aes(x =  Length_um, y = resp_volStand_mg_L_hr)) +
            geom_point() +
            geom_smooth(method="glm",
            method.args=list(family= quasibinomial(link = 'logit'))) #+
            # method.args=list(family="binomial"))

            #geom_smooth(method = "loess", se=FALSE, color="black", formula = Length_um ~ resp_volStand_mg_L_hr) +
            geom_point(aes(colour = as.factor(pH)), size=3) +
            scale_color_manual(values=c("#E69F00", "#56B4E9")) +
            theme_classic() +
            geom_text(x = 4000, y = .06, label = AllLength_lm_eqn(Resp.Master_OM), parse = TRUE) +
            geom_text(x = 4000, y = .05, label = Length_8_lm_eqn(Length_pH8), color="#56B4E9", parse = TRUE) +
            geom_text(x = 4000, y = .04, label = Length_7.5_lm_eqn(Length_pH7.5), color="#E69F00", parse = TRUE)

            
            
            
Resp.Master_OM %>% ggplot(aes(x = Length_um, y = resp_volStand_mg_L_hr)) +
                                geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
                                theme_classic() +
                                ylab("resp_volStand_mg_L_hr") +
                                xlab("Length_um") +
                                geom_point() + 
                                geom_smooth(method='loess')

Resp.Master_OM %>% ggplot(aes(x = Scallop_DW_mg, y = resp_volStand_mg_L_hr)) +
                                geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
                                theme_classic() +
                                ylab("resp_volStand_mg_L_hr") +
                                xlab("Scallop_DW_mg") +
                                geom_point() + 
                                geom_smooth(method='loess')


Resp.Master_OM %>% ggplot(aes(x = Length_um, y = Scallop_DW_mg)) +
                                geom_smooth(method = "lm", se=FALSE, color="black", formula = Scallop_DW_mg ~ Length_um) +
                                theme_classic() +
                                ylab("Scallop_DW_mg") +
                                xlab("Length_um") +
                                geom_point() + 
                                geom_smooth(method='loess')

```

```{r Ws median shell length, echo=TRUE}
summarySE(Resp.Master_OM, measurevar="Length_um")
print(paste( "Median shell length 9/14-10/26 = ", median(Resp.Master_OM$Length_um))) # 3148.36 
Ws <- 3148.36
```




# Calculate rates as ng L-1 O2 um shell length-1 hr-1

#### note: this chunk calls the data that used the 8-channel loligo system and the SDR system to correct for total respiration chamber (vial/vessel, well, etc.) volume separately 
- loligo 8-channel on 9/14/21 = 2.2 ml vessels 
- SDR 24-channel on 9/3-/21 = 1.7 ml wells 

```{r Calculate Resp Rates , echo=TRUE}
# Resp.Master_OM <- Resp.Master_OM[!is.na(Resp.Master_OM$Length_um),]

# NORMALIZED for Shell Size (Length)
 Resp.Master_OM$resp_µmol_L_m_Length_hr <- ( 
             ( ( (abs(Resp.Master_OM$resp_blankStand)) * # call absolute value of resp in mg per minute -  mg O2 L-1 per min-1
                (Resp.Master_OM$volume/1000) ) * # mg per Liter, correct for vial volume 9in mL convert to Liters
              (1/32) * # converted mg L to mmol/L O2 (molar mass of O2 is 32 grams) 
              (1000) ) / # multiple by 1000 to convert mmol/ O2 to umol/L O2
              (Resp.Master_OM$Length_um/1000000)) * # normalize by Dry tissue weight  as to mg O2 L-1 g dry tissue weight-1
            (60) # correct for the time; final value is ug O2 Liter -1 mg dry tissue weight-1 hour-1

Resp.Master_OM$Scallop_DW_mg <- as.numeric(Resp.Master_OM$whole_Dry_weight )
 Resp.Master_OM$resp_µmol_L_g_hr <- ( # NORMALIZED for Dry Tissue Weight
          ( ( (abs(Resp.Master_OM$resp_blankStand)) * # call absolute value of resp in mg per minute -  mg O2 L-1 per min-1
                (Resp.Master_OM$volume/1000) ) * # mg per Liter, correct for vial volume 9in mL convert to Liters
              (1/32) * # converted mg L to mmol/L O2 (molar mass of O2 is 32 grams) 
              (1000) ) / # multiple by 1000 to convert mmol/ O2 to umol/L O2
              (Resp.Master_OM$whole_Dry_weight/1000)) * # normalize by Dry tissue weight  as to mg O2 L-1 g dry tissue weight-1
            (60) # correct for the time; final value is ug O2 Liter -1 mg dry tissue weight-1 hour-1

```

# Mean standard error plot of all data 

```{r Line plot , echo=TRUE}
RespSumTab_Len      <- Resp.Master_OM[!is.na(Resp.Master_OM$resp_µmol_L_m_Length_hr),] %>%  
            summarySE(measurevar="resp_µmol_L_m_Length_hr", groupvars=c("Age", "pCO2", "Fed_Unfed"))
RespSumTab_Len$pCO2 <- factor(RespSumTab_Len$pCO2, c("500 μatm","800 μatm"))
## Use geom_line and geom_point to plot over time
Resp_LengthStand    <- ggplot(data=RespSumTab_Len, aes(x=Age, y=resp_µmol_L_m_Length_hr, color=pCO2)) +
            geom_line(aes(linetype = factor(Fed_Unfed)), size = 0.5) +  
            geom_point()+ 
            scale_color_manual(values=c("forestgreen","darkorange2"))+
            geom_errorbar(aes(ymin=resp_µmol_L_m_Length_hr-se, ymax=resp_µmol_L_m_Length_hr+se), width=.2,
                          position=position_dodge(.1))+
            theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
            scale_x_continuous(name ="Age (days)") +
            labs(title = "F1 Scallops: Food x OA Experiment", 
                 y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%m^{-1}~shell~length%.% hr^{-1}~")")) +
            scale_linetype_manual(values = c("High food" = "solid", "Low food" = "dashed"))  +
            theme(legend.position="none") +
            # facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) 
            facet_wrap(~pCO2)

#pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/Juvenile_respiration_FoodxOA.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/Juvenile_respiration_FoodxOA_LengthStandardized.pdf"))
Resp_LengthStand
dev.off()

Resp_LengthStand



RespSumTab_DW      <- Resp.Master_OM[!is.na(Resp.Master_OM$resp_µmol_L_g_hr),] %>%  
          summarySE(measurevar="resp_µmol_L_g_hr", groupvars=c("Age", "pCO2", "Fed_Unfed"))
RespSumTab_DW$pCO2 <- factor(RespSumTab_DW$pCO2, c("500 μatm","800 μatm"))
## Use geom_line and geom_point to plot over time
Resp_DryWgtStand   <- ggplot(data=RespSumTab_DW, aes(x=Age, y=resp_µmol_L_g_hr, color=pCO2)) +
          geom_line(aes(linetype = factor(Fed_Unfed)), size = 0.5) +  
          geom_point()+ 
          scale_color_manual(values=c("forestgreen","darkorange2"))+
          geom_errorbar(aes(ymin=resp_µmol_L_g_hr-se, ymax=resp_µmol_L_g_hr+se), width=.2,
                        position=position_dodge(.1))+
          theme_bw() +  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+ 
          scale_x_continuous(name ="Age (days)") +
          labs(title = "F1 Scallops: Food x OA Experiment", 
               y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%g^{-1}~DW%.% hr^{-1}~")")) +
          scale_linetype_manual(values = c("High food" = "solid", "Low food" = "dashed"))  +
          theme(legend.position="none") +
          # facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) 
          facet_wrap(~pCO2)
Resp_DryWgtStand

pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/Juvenile_respiration_FoodxOA_LengthStandardized.pdf"))
Resp_DryWgtStand
dev.off()

```


# Analysis 

## 9/14/2021 F1 juvenile scallops

**About**
- two pCO2 treatments 
- **before** we culled and started the food limitation trials


#### number of replicates for analysis...

```{r 9/14 replicates, echo=FALSE}

# model effect of treatment on resp rate 20210507
Resp_0914 <- Resp.Master_OM %>% 
              dplyr::filter(Date %in% '9/14/2021')  %>% # call only 9/14
              dplyr::filter(!Chamber_tank  %in% 'blank')

Resp_0914 %>% dplyr::group_by(Chamber_tank) %>% dplyr::summarise(n()) # tank replication

```

## 20210914 linear model, diagnostics, and plots

```{r 9/14 lm diag and figs, echo=TRUE}




# Shell length standardized (SL) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::



library("ggpubr")
ggboxplot(Resp_0914, x = "pH", y = "resp_µmol_L_m_Length_hr", color = "Replicate",
          add = c("mean_se", "dotplot"),
          palette = c("#00AFBB", "#E7B800", "brown", "grey"))



require(nlme)
LMEmod_0914_SL<-lme(resp_µmol_L_m_Length_hr ~ pCO2, random=~1|Replicate, data=Resp_0914)
pander(anova(LMEmod_0914_SL), style='rmarkdown')


# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |  19   |  38.42  | 5.912e-06 |
# |    **pCO2**     |   1   |  19   | 0.8712  |  0.3623   |





# Shell length standardized (SL) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


LMmod_0914_SL <- aov(lm(resp_µmol_L_m_Length_hr~pCO2,data=Resp_0914))
pander(summary(LMmod_0914_SL), style='rmarkdown') 
# |    &nbsp;     | Df | Sum Sq | Mean Sq | F value | Pr(>F) |
# |:-------------:|:--:|:------:|:-------:|:-------:|:------:|
# |   **pCO2**    | 1  | 67.77  |  67.77  | 0.6327  | 0.4348 |
# | **Residuals** | 22 |  2356  |  107.1  |   NA    |   NA   |
check_model(LMmod_0914_SL) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_0914_SL)) #  normal - 0.3875
leveneTest(LMmod_0914_SL) # good - 0.6186

DF   <- paste( (summary(LMmod_0914_SL)[[1]][["Df"]])[1], (summary(LMmod_0914_SL)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_0914_SL)[[1]][["F value"]])[1]
pval <- (summary(LMmod_0914_SL)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210914_respiration.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210914_respiration_length.standardized.pdf"))
ggplot(Resp_0914, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_m_Length_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 35)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 20210914 (shell length stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%m^{-1}~shell~length%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")")) # + 
              # annotate("text", x=1.2, y=2.8, size = 4, label = "aov(Resp~pCO2)") +
              # annotate("text", x=1.2, y=2.6, size = 4, label= paste('DF =',DF,'F =', signif(Fval, digits=3), 'p value =', signif(pval, digits=3), sep=" ")) 
dev.off()






# Whole animal Dry weight standardized (DW) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


library("ggpubr")
ggboxplot(Resp_0914, x = "pH", y = "resp_µmol_L_g_hr", color = "Replicate",
          add = c("mean_se", "dotplot"),
          palette = c("#00AFBB", "#E7B800", "brown", "grey"))


require(nlme)
LMEmod_0914_DW<-lme(resp_µmol_L_g_hr ~ pCO2, random=~1|Replicate, data=Resp_0914)
pander(anova(LMEmod_0914_DW), style='rmarkdown')


# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |  19   |  38.42  | 5.912e-06 |
# |    **pCO2**     |   1   |  19   | 0.8712  |  0.3623   |




LMmod_0914_DW <- aov(lm(resp_µmol_L_g_hr~pCO2,data=Resp_0914))
pander(summary(LMmod_0914_DW), style='rmarkdown')
check_model(LMmod_0914_DW) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_0914_DW)) #  normal - 0.3875
leveneTest(LMmod_0914_DW) # good - 0.6186

DF   <- paste( (summary(LMmod_0914)[[1]][["Df"]])[1], (summary(LMmod_0914)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_0914)[[1]][["F value"]])[1]
pval <- (summary(LMmod_0914)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210914_respiration_DW.standardized.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210914_respiration_DW.standardized.pdf"))
ggplot(Resp_0914, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_g_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 120)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 20210914 (whole dry weight stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%g^{-1}~DW%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")"))
dev.off()

```



## 9/14/2021 F1 juvenile scallops

**About**

- two pCO2 treatments 

- *before* we culled and started the food limitation trials


#### number of replicates for analysis...

```{r 9/30 replicates, echo=FALSE}

Resp_0930 <- Resp.Master_OM %>% 
  dplyr::filter(Date %in% '9/30/2021')  %>% # call only 9/14
  dplyr::select(-Center)

Resp_0930 %>% dplyr::group_by(Chamber_tank, Food ) %>% dplyr::summarise(n()) # tank replication

```

## 20210930 linear model, diagnostics, and plots

```{r 9/30 lm diag and figs, echo=TRUE}


# Visualize the data with the random effet as treplicate 
library("ggpubr")
Resp_0930$pHxFood <- paste(Resp_0930$pH, Resp_0930$Food, sep = "_")
ggboxplot(Resp_0930, x = "pHxFood", y = "resp_µmol_L_m_Length_hr", color = "Replicate",
          add = c("mean_se", "dotplot"),
          palette = c("#00AFBB", "#E7B800", "brown", "grey"))


# Shell length standardized (SL) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

require(nlme)
LMEmod_0930_SL<-lme(resp_µmol_L_m_Length_hr ~ pCO2 * Food, random=~1|Replicate, data=Resp_0930)
pander(anova(LMEmod_0930_SL), style='rmarkdown')
# |     &nbsp;      | numDF | denDF | F-value | p-value |
# |:---------------:|:-----:|:-----:|:-------:|:-------:|
# | **(Intercept)** |   1   |  66   |  606.3  |    0    |
# |    **pCO2**     |   1   |  66   |  4.42   | 0.03934 |
# |    **Food**     |   1   |  66   |  3.984  | 0.05006 |
# |  **pCO2:Food**  |   1   |  66   | 0.01138 | 0.9154  |


LMmod_0930_SL <- aov(lm(resp_µmol_L_m_Length_hr~pCO2*Food,data=Resp_0930))
pander(summary(LMmod_0930_SL), style='rmarkdown')
# |    &nbsp;     | Df | Sum Sq | Mean Sq | F value | Pr(>F)  |
# |:-------------:|:--:|:------:|:-------:|:-------:|:-------:|
# |   **pCO2**    | 1  |  1340  |  1340   |  4.42   | 0.03917 |
# |   **Food**    | 1  |  1208  |  1208   |  3.984  | 0.04988 |
# | **pCO2:Food** | 1  |  3.45  |  3.45   | 0.01138 | 0.9154  |
# | **Residuals** | 69 | 20923  |  303.2  |   NA    |   NA    |
check_model(LMmod_0930_SL) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_0930_SL)) #  normal - 0.1295
leveneTest(LMmod_0930_SL) # good - 0.1488

DF   <- paste( (summary(LMmod_0930_SL)[[1]][["Df"]])[1], (summary(LMmod_0930_SL)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_0930_SL)[[1]][["F value"]])[1]
pval <- (summary(LMmod_0930_SL)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210930_respiration.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210930_respiration_length.standardized.pdf"))
ggplot(Resp_0930, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_m_Length_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 120)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 20210930 (shell length stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%m^{-1}~shell~length%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")"))  + 
               stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
              facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) # +
              # annotate("text", x=1.2, y=2.8, size = 4, label = "aov(Resp~pCO2)") +
              # annotate("text", x=1.2, y=2.6, size = 4, label= paste('DF =',DF,'F =', signif(Fval, digits=3), 'p value =', signif(pval, digits=3), sep=" ")) 
dev.off()


# Whole animal Dry weight standardized (DW) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


LMmod_0930_DW <- aov(lm(resp_µmol_L_g_hr~pCO2*Food,data=Resp_0930))
pander(summary(LMmod_0930_DW), style='rmarkdown')
# |    &nbsp;     | Df | Sum Sq | Mean Sq | F value | Pr(>F)  |
# |:-------------:|:--:|:------:|:-------:|:-------:|:-------:|
# |   **pCO2**    | 1  | 11725  |  11725  |  4.432  | 0.03896 |
# |   **Food**    | 1  | 26823  |  26823  |  10.14  | 0.00219 |
# | **pCO2:Food** | 1  |  2531  |  2531   |  0.957  | 0.3314  |
# | **Residuals** | 68 | 179878 |  2645   |   NA    |   NA    |
check_model(LMmod_0930_DW) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_0930_DW)) # non normal 2.42e-08
leveneTest(LMmod_0930_DW) # good - 0.2719

DF   <- paste( (summary(LMmod_0930)[[1]][["Df"]])[1], (summary(LMmod_0930)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_0930)[[1]][["F value"]])[1]
pval <- (summary(LMmod_0930)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210930_respiration_DW.standardized.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/20210930_respiration_DW.standardized.pdf"))
ggplot(Resp_0930, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_g_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 200)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 20210930 (whole dry weight stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%g^{-1}~DW%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")"))  + 
               stat_summary(fun.y=mean, geom="point", shape=18, size=4, color="black", fill="white") +
                facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) # +
dev.off()
```




## 10/26/2021 F1 juvenile scallops

**About**

- two pCO2 treatments 

- *before* we culled and started the food limitation trials


#### number of replicates for analysis...

```{r 10/26 replicates, echo=FALSE}

Resp_01026 <- Resp.Master_OM %>% 
  dplyr::filter(Date %in% '10/26/2021')  %>% # call only 10/14
  dplyr::select(-Center)

Resp_01026 %>% dplyr::group_by(Chamber_tank, Food ) %>% dplyr::summarise(n()) # tank replication

```


## 20211026 linear model, diagnostics, and plots

```{r 10/26 lm diag and figs, echo=TRUE}

# Visualize the data with the random effet as treplicate 
library("ggpubr")
Resp_01026$pHxFood <- paste(Resp_01026$pH, Resp_01026$Food, sep = "_")
ggboxplot(Resp_01026, x = "pHxFood", y = "resp_µmol_L_m_Length_hr", color = "Replicate",
          add = c("mean_se", "dotplot"),
          palette = c("#00AFBB", "#E7B800", "brown", "grey"))


# Shell length standardized (SL) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

require(nlme)
LMEmod_01026_SL<-lme(resp_µmol_L_m_Length_hr ~ pCO2 * Food, random=~1|Replicate, data=Resp_01026)
pander(anova(LMEmod_01026_SL), style='rmarkdown')

# |     &nbsp;      | numDF | denDF | F-value |  p-value  |
# |:---------------:|:-----:|:-----:|:-------:|:---------:|
# | **(Intercept)** |   1   |  27   |  804.6  |     0     |
# |    **pCO2**     |   1   |  27   |  30.61  | 7.304e-06 |
# |    **Food**     |   1   |  27   |  299.6  | 4.441e-16 |
# |  **pCO2:Food**  |   1   |  27   |  19.53  | 0.000145  |


# Shell length standardized (SL) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


LMmod_01026_SL <- aov(lm(resp_µmol_L_m_Length_hr~pCO2*Food,data=Resp_01026))
pander(summary(LMmod_01026_SL), style='rmarkdown')
check_model(LMmod_01026_SL) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_01026_SL)) #  normal - 0.3875
leveneTest(LMmod_01026_SL) # good - 0.6186

DF   <- paste( (summary(LMmod_01026_SL)[[1]][["Df"]])[1], (summary(LMmod_01026_SL)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_01026_SL)[[1]][["F value"]])[1]
pval <- (summary(LMmod_01026_SL)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/202101026_respiration.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/202101026_respiration_length.standardized.pdf"))
ggplot(Resp_01026, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_m_Length_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 250)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 202101026 (shell length stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%m^{-1}~shell~length%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")"))  + 
              facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) # +
              # annotate("text", x=1.2, y=2.8, size = 4, label = "aov(Resp~pCO2)") +
              # annotate("text", x=1.2, y=2.6, size = 4, label= paste('DF =',DF,'F =', signif(Fval, digits=3), 'p value =', signif(pval, digits=3), sep=" ")) 
dev.off()


# Whole animal Dry weight standardized (DW) ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


LMmod_01026_DW <- aov(lm(resp_µmol_L_g_hr~pCO2*Food,data=Resp_01026))
pander(summary(LMmod_01026_DW), style='rmarkdown')
check_model(LMmod_01026_DW) # observe the diagnostics of the model
shapiro.test(residuals(LMmod_01026_DW)) #  normal - 0.3875
leveneTest(LMmod_01026_DW) # good - 0.6186

DF   <- paste( (summary(LMmod_01026)[[1]][["Df"]])[1], (summary(LMmod_01026)[[1]][["Df"]])[2], sep = '/')
Fval <- (summary(LMmod_01026)[[1]][["F value"]])[1]
pval <- (summary(LMmod_01026)[[1]][["Pr(>F)"]])[1]

# pdf(paste0("C:/Users/samjg/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/202101026_respiration_DW.standardized.pdf"))
pdf(paste0("C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_OA/RAnalysis/Output/Respiration/202101026_respiration_DW.standardized.pdf"))
ggplot(Resp_01026, aes(x = factor(pCO2, level = c('500 μatm', '800 μatm')), resp_µmol_L_g_hr , fill = pCO2)) +
              theme(panel.grid=element_blank()) +
              geom_boxplot(size=0.2, width=0.5, alpha=0.1, aes(fill=pCO2)) +
              scale_fill_manual(values=c("white","grey50")) +
              geom_point(shape = 21, size = 2, position = position_jitterdodge(jitter.width = 0.1)) +
              theme_classic() +
              scale_x_discrete(labels= c('~500 μatm', '~800 μatm')) +
              scale_y_continuous(expand = c(0, 0), limits = c(0, 150)) +
              theme(axis.text=element_text(size=12),
                    axis.title=element_text(size=14,face="bold")) +
              labs(title = "F1 Scallops: respiration rates on 202101026 (whole dry weight stand.)", 
                   y = expression(Respiration~rate~"("~μmol~L^{-1}~O[2]%.%g^{-1}~DW%.% hr^{-1}~")"),
                   x = expression(italic(p)*CO[2]~Treatment~"("~μ*atm~")"))  + 
              facet_wrap(~factor(Fed_Unfed, level = c('Low food', 'High food'))) # +
dev.off()
```